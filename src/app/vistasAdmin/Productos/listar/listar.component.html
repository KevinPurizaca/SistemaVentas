<div class="col-12" >
  <p-toast key="tst"[baseZIndex]="99999" ></p-toast>



  <p-panel   header="Busqueda productos" [collapsed]="false" [toggleable]="true" class="line-height-3 m-0"> 
      <form  [formGroup]="formBusqueda"  >
          <div class="p-fluid p-formgrid grid" >

              <div class="col-4 md:col-3">
                <label class="label-filter-text">Nombre</label>
                <input type="text" formControlName="txtNombre" pInput placeholder="Nombre Producto" 
                class="p-inputtext p-component p-element">
              </div>

              
              <div class="col-12 md:col-4" >
                <label class="label-filter-text" >Categoria</label>
                <p-dropdown placeholder="Seleccione"  
                [options]="categorias"  [filter]="true"
                formControlName="cboCategoria"
                optionLabel="nombre" optionValue="id" >
               
                </p-dropdown>
                
            </div>

              
            <div class="col-12 md:col-4">
              <label class="label-filter-text">Marca</label>
              <p-dropdown placeholder="Seleccione"  [filter]="true"
              formControlName="cboMarca"  [options]="marca"   optionLabel="nombre"
              optionLabel="nombre" optionValue="id" >
              </p-dropdown>
          </div>
         


          <div class="col-12 md:col-3">
            <label class="label-filter-text">Proveedor</label>
            <p-dropdown placeholder="Seleccione"  [filter]="true"
            formControlName="cboProveedor" [options]="proveedor" 
            optionLabel="nombrecompletos" optionValue="id" >
            </p-dropdown>
        </div>

          
        <div class="col-12 md:col-3">
          <label class="label-filter-text">Estado</label>
          <p-dropdown placeholder="Seleccione" 
          formControlName="cboEstado"
          optionLabel="value" optionValue="id">
          </p-dropdown>
      </div>
                          
          </div>
        
          <div class="p-fluid p-formgrid grid mt-2">
             
            <div class="col-fixed md:col-1"  >      
 
                    <p-button 
                    icon="pi pi-file-excel" styleClass="p-button-success mr-2" 
                    pTooltip="Descargar Excel"  tooltipPosition="bottom">
                   
                  </p-button>    
           </div>  
            <div class="col-2 md:col-2"  > 
                  <p-button
                  label="Agregar" [routerLink]="['../Crear']"   styleClass="p-button-raised mr-2 p-button-help" 
                    ></p-button>

         </div>  
        
  
            

            <div class="col-12 md:col-5"></div>
            <div class="col-12 md:col-2" >
                 <p-button
                label="Buscar" (onClick)="buscar()"
                styleClass="p-button  p-button-info mr-2 mb-2 p-button"  
                  >  </p-button>
                
            </div>
            <div class="col-12 md:col-2" >
                <p-button
                label="Limpiar"
                styleClass="p-button  p-button-secondary mr-2 mb-2 p-button"  
                    (click)="limpiarFormulario()">
                    
                </p-button>
            </div>            
        </div>          
      </form>

      
  </p-panel>
</div>


<div class="col-12">
  <p-panel header="Tabla Productos" [toggleable]="true" class="line-height-3 m-0">
    <p-toast key="tst"[baseZIndex]="99999" ></p-toast>
    <p-table #dt [value]="producto" [loading]="loading"
              [rows]="5" [paginator]="true" [rowHover]="true" dataKey="id"
               currentPageReportTemplate="Mostrando {first} a {{limite}} de {{totalRecord}} Registros" 
              [showCurrentPageReport]="true" [scrollable]="true" responsiveLayout="scroll"
              >

      <ng-template pTemplate="header">
          <tr>
            <th  style="min-width:8rem;">Codigo</th>
              <th  pSortableColumn="nombre" style="min-width:20rem">Nombre<p-sortIcon field="nombre"></p-sortIcon></th>
              <th  style="min-width:8rem;justify-content: center;">Imagen</th>
              <th  style="min-width:8rem;justify-content: center;">Imagen2</th>
              <th  style="min-width:8rem;justify-content: center;">Imagen3</th>
              <th  pSortableColumn="precio"  style="min-width:8rem">Precio<p-sortIcon field="precio"></p-sortIcon></th>
              <th  pSortableColumn="categoria" style="min-width:12rem;">Categoria<p-sortIcon field="categoria"></p-sortIcon></th>
              <th  pSortableColumn="marca"  style="min-width:8rem;">Marca<p-sortIcon field="marca"></p-sortIcon></th>
              <th  pSortableColumn="estrellas"  style="min-width:10rem;">Clasificacion<p-sortIcon field="estrellas"></p-sortIcon></th>
              <th  pSortableColumn="vstock"  style="min-width:8rem;">Stock<p-sortIcon field="vstock"></p-sortIcon></th>
              <th pFrozenColumn  alignFrozen="right">
                Acciones
              </th>
          </tr>
      </ng-template>
      <ng-template pTemplate="body" let-data>
          <tr>
            <td style="min-width:8rem">{{data.vCodigo}}</td>
              <td style="min-width:20rem">{{data.nombre}}</td>
              <td style="min-width:8rem;justify-content: center;">
                <img src="{{ data.img1 }}" onerror="this.src='/assets/imgno.jpg'" [alt]="data.nombre" width="80" height="70" class="shadow-4" />
              </td>
              <td style="min-width:8rem;justify-content: center;">
                <img src="{{ data.img2 }}" onerror="this.src='/assets/imgno.jpg'" [alt]="data.nombre" width="80" height="70" class="shadow-4" />
              </td>
              <td style="min-width:8rem;justify-content: center;">
                <img src="{{ data.img3 }}" onerror="this.src='/assets/imgno.jpg'" [alt]="data.nombre" width="80" height="70" class="shadow-4" />
              </td>
              <td  style="min-width:8rem;">S/. {{data.precio | currency:'':'':'1.2-2'}}</td>
              <td style="min-width:12rem;">{{data.categoria}}</td>
              <td  style="min-width:8rem;">{{data.marca}}</td>
              <td  style="min-width:10rem;"><p-rating [ngModel]="data.estrellas" [readonly]="true" [cancel]="false"></p-rating></td>
              <td  style="min-width:8rem;"><span [class]="'product-badge status-' + data.vstock.toLowerCase()">{{data.vstock}}</span></td>

              <td pFrozenColumn  alignFrozen="right">

                <button (click)="eliminarProducto($event,data.id)" pButton icon="pi pi-trash" title="Eliminar"
                        class="p-button-danger btndelete">
                </button>     
    
                <button (click)="editProducto($event,data)"pButton icon="pi pi-file-edit" 
                        title="Editar"class="p-button-info btnedit" >
                </button>
                <button pButton icon="pi pi-eye" 
                title="Ver Descripcion"class="p-button-info btnedit" >
                </button>
                 
                <button (click)="cambiarestado($event,data)"pButton [icon]="data.icono"
                        [title]="data.poolTip +'Producto'" class="p-button-warning btnecambiarestado">
                </button>
              </td>

          </tr>
      </ng-template>
      <ng-template pTemplate="summary">
          <div class="flex align-items-center justify-content-between">
            En Total hay   {{producto ? producto.length : 0 }} Productos.
          </div>
      </ng-template>
  </p-table>
  </p-panel>
</div>





<p-dialog [(visible)]="idDialog" [style]="{width: '850px'}" header="Detalle Producto" [modal]="true" class="p-fluid">
  <ng-template pTemplate="content" >
      <form   [formGroup]="formProductoEditable">
          <div class="p-fluid p-formgrid grid" style="margin-top:5px;">    
            <!-- <div class="col-12 md:col-12 imgmodal">         
            <img [src]="lsproductodto.img1"   class="imgmodal1" [alt]="lsproductodto.img1" >
          </div> -->
                  <div class="col-4 md:col-12 ">
                      <label for="txtNombredg" class="divnombre">Nombre</label>
                      <input type="text" pInputText placeholder="Ingrese Nombre"  
                      [(ngModel)]="lsproductodto.nombre" formControlName="txtNombredg"  
                       name="producto.nombre" required autocomplete="off" />
                       <small class="ng-dirty ng-invalid" 
                       *ngIf="submitted && !lsproductodto.nombre">Ingrese Nombre.</small>

                  </div>
                  <div class="col-12 md:col-7">
                    <label for="cboCategoriadg">Categoria</label>
                    <p-dropdown formControlName="cboCategoriadg"
                    [(ngModel)]="lsproductodto.id_categoria" 
                    [options]="categorias" optionValue="id"
                    optionLabel="nombre" placeholder="Seleccione"
                     ></p-dropdown>
                     <small class="ng-dirty ng-invalid" 
                     *ngIf="submitted && !producto2.id_categoria">Seleccione Categoria.</small>

                </div>
                            
              <div class="col-12 md:col-5">
                <label for="cboMarcadg">Marca</label>
                <p-dropdown formControlName="cboMarcadg" 
                [options]="marca"  optionValue="id"
                optionLabel="nombre" 
                [(ngModel)]="lsproductodto.id_marca" 
                placeholder="Seleccione"></p-dropdown>
                <small class="ng-dirty ng-invalid" 
                 *ngIf="submitted && !producto2.id_marca">Seleccion Marca.</small>

            </div>

            <div class="col-12 md:col-5">
              <label class="label-filter-text">Proveedor</label>
              <p-dropdown placeholder="Seleccione" 
              formControlName="cboProveedordg" [options]="proveedor"
              [(ngModel)]="lsproductodto.id_proveedor" 
              optionLabel="nombrecompletos" optionValue="id" >
              </p-dropdown>
              <small class="ng-dirty ng-invalid" 
              *ngIf="submitted && !producto2.id_proveedor">Seleccione Proveedor.</small>
          </div>

                  <div class="col-12 md:col-4">
                    <label for="txtPreciodg">Precio</label>
                    <input type="text" pInputText placeholder="Precio" autocomplete="off"
                    name="precio" formControlName="txtPreciodg"
                    [(ngModel)]="lsproductodto.precio"  required  />
                    <small class="ng-dirty ng-invalid" *ngIf="submitted && !lsproductodto.precio">Ingrese Precio.</small>
                </div>

                <div class="col-12 md:col-3">
                  <label for="txtStockdg">Stock</label>
                  <input type="text" pInputText placeholder="Stock" name="stock" autocomplete="off"
                   formControlName="txtStockdg" [(ngModel)]="lsproductodto.stock"   required/>
                   <small class="ng-dirty ng-invalid" *ngIf="submitted && !lsproductodto.stock">Ingrese Stock.</small>

                  </div>


          </div>
      </form>
    
  </ng-template>

  <ng-template pTemplate="footer"  >
      <button pButton pRipple label="Cancelar" icon="pi pi-times" class="p-button-text" (click)="hideDialog()"></button>
      <button pButton pRipple label="Guardar" icon="pi pi-check" class="p-button-text" (click)="actualizarProducto($event)"></button>
  </ng-template>
</p-dialog>


<p-confirmPopup key="deleteProducto"></p-confirmPopup>